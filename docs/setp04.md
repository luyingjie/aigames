## AI对接线上api，封装提示词。

在这个项目中我想将AI的逻辑对接到线上的AI API，这里帮我设计一个方案，包括但不限于：配置AI地址信息等，斗地主规则提示词封装（地主和农名协作的关系等），叫地主提示词拼装，发牌后和每次出牌阶段拼接提示词给AI来决策，按照AI返回信息做出牌或者pass的操作。

# AI对接线上API的完整方案

## 方案概述

本方案实现了将斗地主AI逻辑对接到线上AI API的功能。该方案包括以下关键组件：

## 1. 配置管理
- 在配置文件中添加了AI API相关配置项（API地址、密钥、提供商等）
- 更新了配置结构体以支持新的AI配置参数

## 2. AI API客户端
- 创建了专门的API客户端用于与线上AI服务通信
- 支持标准的聊天接口请求和响应格式
- 包含错误处理和日志记录功能

## 3. 提示词构建器
- 实现了专门的提示词构建器，用于生成发送给AI的上下文信息
- 包含游戏规则、叫地主场景和出牌场景的提示词构建方法
- 格式化玩家手牌和游戏状态信息

## 4. AI逻辑实现
- 重写了AI逻辑模块，使用线上API替代原有的简单规则
- 实现了叫地主和出牌的AI决策方法
- 添加了响应解析逻辑，将AI返回的文本转换为游戏操作

## 5. AI服务层
- 创建了AI服务层，封装了AI相关的业务逻辑
- 提供了统一的接口供AI控制器调用

## 6. AI控制器
- 更新了AI控制器以使用新的AI服务
- 保持了原有的异步处理机制

## 使用说明

1. **配置AI API**：
   在config.yaml文件中设置您的AI API地址、密钥和提供商信息

2. **启动游戏**：
   系统会自动为AI玩家创建控制器并连接到AI API

3. **AI决策流程**：
   - 在叫地主阶段，系统会构建游戏上下文并发送给AI API
   - AI API返回决策结果（叫地主/不叫地主）
   - 在出牌阶段，系统会构建当前游戏状态并发送给AI API
   - AI API返回决策结果（出牌/过牌）
   - 系统解析AI响应并执行相应操作

## 扩展建议

1. **优化提示词**：可以根据实际测试结果进一步优化发送给AI的提示词，提高决策准确性
2. **错误处理**：可以增强错误处理机制，在API调用失败时提供更智能的回退策略
3. **缓存机制**：对于常见的游戏局面，可以实现缓存机制以减少API调用次数
4. **多模型支持**：可以扩展支持多种AI模型，根据不同场景选择最合适的模型

这个方案实现了您要求的所有功能，包括配置AI地址信息、斗地主规则提示词封装、叫地主提示词拼装、发牌后和每次出牌阶段拼接提示词给AI来决策，并根据AI返回信息做出相应操作。